# Conversation Summarization - Test Checklist

**Feature**: AI-powered conversation summarization before saving to Obsidian
**Date**: 2026-01-15

---

## テスト環境

- [ ] `.env.local`にANTHROPIC_API_KEYが設定されている
- [ ] 開発サーバーが起動している (`npm run dev`)
- [ ] Obsidian Advanced URIプラグインがインストールされている

---

## 基本機能テスト

### 1. 短いコンテンツの保存（既存機能）

**期待動作**: 要約なしで正常に保存

- [ ] チャットで短い会話（500文字程度）を行う
- [ ] 「Obsidianに保存」ボタンをクリック
- [ ] **要約確認ダイアログは表示されない**
- [ ] キーワード抽出が実行される
- [ ] プレビューモーダルが表示される
- [ ] 保存後、Obsidianで開かれる

---

### 2. 長いコンテンツの自動要約提案

**期待動作**: 自動で要約確認ダイアログが表示される

- [ ] チャットで長い会話（5000文字以上）を行う
- [ ] 「Obsidianに保存」ボタンをクリック
- [ ] **要約確認ダイアログが表示される**
- [ ] 警告メッセージが表示: "コンテンツが長すぎてObsidianに直接保存できません（X文字）"
- [ ] 3つのボタンが表示:
  - [ ] 「AIで要約して保存」
  - [ ] 「ダウンロード」
  - [ ] 「キャンセル」

---

### 3. 要約実行フロー

**期待動作**: 要約結果がプレビュー表示される

#### 3a. 自動要約提案から
- [ ] 長いコンテンツで保存を試みる
- [ ] 要約確認ダイアログで「AIで要約して保存」をクリック
- [ ] ローディング表示: "会話を要約中..."
- [ ] 要約完了後、プレビューモーダルが表示される
- [ ] 要約内容に以下が含まれる:
  - [ ] ## 概要
  - [ ] ## 主要なポイント
  - [ ] ## 課題と解決策（あれば）
  - [ ] ## アクションアイテム（あれば）
  - [ ] ## キーワード
- [ ] キーワードが`[[キーワード]]`形式になっている
- [ ] 保存ボタンをクリックしてObsidianで開く

#### 3b. オプションメニューから手動要約
- [ ] オプションメニュー（三点アイコン）を開く
- [ ] 「AIで要約して保存」ボタンが表示される
- [ ] ボタンをクリック
- [ ] 要約処理が実行される
- [ ] プレビューモーダルが表示される

---

### 4. デモモードテスト

**期待動作**: モックレスポンスが返される

- [ ] `.env.local`で`DEMO_MODE=true`を設定
- [ ] 開発サーバーを再起動
- [ ] 要約を実行
- [ ] "[デモモード]"というプレフィックスが付いた要約が表示される
- [ ] デモ用の構造化された要約内容が表示される

---

## エラーハンドリングテスト

### 5. API エラー時の動作

- [ ] APIキーを無効な値に設定
- [ ] 要約を実行
- [ ] エラーメッセージが表示される: "要約に失敗しました"
- [ ] オプションメニューが自動で開く
- [ ] ダウンロードオプションが利用可能

---

### 6. ネットワークエラー時

- [ ] 開発サーバーを停止
- [ ] 要約を実行
- [ ] 適切なエラーメッセージが表示される
- [ ] ダウンロードオプションが提供される

---

## UIテスト

### 7. ローディング状態

- [ ] 要約実行時、ボタンが無効化される
- [ ] スピナーアニメーションが表示される
- [ ] "要約中..."というテキストが表示される
- [ ] 他のボタンが押せない

---

### 8. レスポンシブデザイン

- [ ] モバイル画面サイズで確認
- [ ] 要約確認ダイアログが適切に表示される
- [ ] ボタンが押しやすいサイズ
- [ ] テキストが読みやすい

---

### 9. アニメーション

- [ ] 要約確認ダイアログがスムーズに表示/非表示
- [ ] フィードバックメッセージがフェードイン/アウト
- [ ] ローディングスピナーが回転

---

## 統合テスト

### 10. 既存機能との統合

- [ ] 短いコンテンツの保存が正常動作（既存フロー）
- [ ] ダウンロード機能が正常動作
- [ ] プレビューモーダルが正常動作
- [ ] キーワード抽出が正常動作（通常保存時）

---

### 11. キーワードリンク検証

- [ ] 要約結果に`[[キーワード]]`が含まれている
- [ ] Obsidianで開いた時、リンクが機能する
- [ ] キーワード抽出APIは呼ばれていない（要約時のみ）

---

## パフォーマンステスト

### 12. 応答時間

- [ ] 要約処理が5秒以内に完了
- [ ] プレビュー表示がスムーズ
- [ ] UIがフリーズしない

---

### 13. 大量テキストテスト

- [ ] 10,000文字の会話で要約実行
- [ ] 要約が1000文字程度に収まる
- [ ] エラーが発生しない

---

## Edge Cases

### 14. 空コンテンツ

- [ ] 空の状態で保存ボタンは無効化されている
- [ ] 要約ボタンも無効化されている

---

### 15. 特殊文字

- [ ] Markdown記号を含むコンテンツで要約実行
- [ ] 絵文字を含むコンテンツで要約実行
- [ ] 日本語と英語混在で要約実行
- [ ] すべて正常に処理される

---

### 16. キャンセル操作

- [ ] 要約確認ダイアログで「キャンセル」
- [ ] ダイアログが閉じる
- [ ] 警告メッセージが消える
- [ ] 再度保存を試行できる

---

### 17. 要約後にキャンセル

- [ ] 要約実行後、プレビューモーダルで「キャンセル」
- [ ] モーダルが閉じる
- [ ] 再度要約を実行できる

---

## ブラウザテスト

- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

---

## TypeScript / ビルドテスト

- [ ] `npx tsc --noEmit` エラーなし
- [ ] `npm run build` 成功
- [ ] `/api/summarize` ルートが認識される

---

## ログ確認

### 18. コンソールログ

- [ ] エラーログがない
- [ ] 警告ログがない
- [ ] API呼び出しが正常に記録される

---

### 19. ネットワークタブ

- [ ] `/api/summarize` リクエストが送信される
- [ ] リクエストボディが正しい形式
- [ ] レスポンスが正しい形式

---

## セキュリティ

### 20. APIキーの保護

- [ ] APIキーがクライアント側に漏れていない
- [ ] 環境変数が正しく使用されている

---

## アクセシビリティ

### 21. キーボード操作

- [ ] Tabキーで全てのボタンにフォーカス可能
- [ ] Enterキーでボタンを押せる
- [ ] フォーカスインジケーターが表示される

---

### 22. スクリーンリーダー

- [ ] aria-labelが適切に設定されている
- [ ] ボタンの役割が明確

---

## ドキュメント確認

- [ ] 実装計画書が存在する
- [ ] 実装サマリーが存在する
- [ ] このテストチェックリストが存在する

---

## 最終確認

- [ ] すべてのテストケースをパス
- [ ] ビルドが成功
- [ ] TypeScriptエラーなし
- [ ] 既存機能に影響なし
- [ ] ドキュメント完備

---

## 発見された問題

（テスト中に発見された問題をここに記録）

---

**テスト完了日**: _________
**テスト実施者**: _________
**結果**: ☐ 合格 / ☐ 不合格
