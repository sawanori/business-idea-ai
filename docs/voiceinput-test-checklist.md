# VoiceInput Push-to-Talk テストチェックリスト

## テスト実施日: ___________
## テスト実施者: ___________

---

## 1. 基本機能テスト

### 1.1 正常系 - Push-to-Talk
- [ ] ボタンを押すと録音が開始される
- [ ] 録音中インジケータ（赤いボタン + パルスアニメーション）が表示される
- [ ] ボタンを離すと録音が停止する
- [ ] 「音声を処理中...」が表示される
- [ ] 音声が文字起こしされてテキストエリアに表示される
- [ ] エラーメッセージが表示されない

**期待時間**: 押してから離すまで 2-5秒程度で正常動作

### 1.2 素早い操作
- [ ] ボタンを素早く（0.5秒以内）押して離す
- [ ] エラーが発生しない
- [ ] 「音声を認識できませんでした」または正常終了する
- [ ] 録音が継続しない（重要）

**重要**: この修正により、素早い操作でも録音が確実に停止するはず

### 1.3 長押し（タイムアウト）
- [ ] ボタンを60秒間押し続ける
- [ ] 60秒経過時に自動的に録音が停止する
- [ ] 「録音時間が上限に達しました（60秒）」メッセージが表示される
- [ ] 音声処理が開始される

---

## 2. イベントハンドラテスト

### 2.1 マウス操作（PC）
- [ ] `onMouseDown`: ボタンを押すと録音開始
- [ ] `onMouseUp`: ボタンを離すと録音停止
- [ ] `onMouseLeave`: 録音中にボタンの外にマウスを移動 → 録音停止

### 2.2 タッチ操作（スマートフォン/タブレット）
- [ ] `onTouchStart`: ボタンをタッチすると録音開始
- [ ] `onTouchEnd`: 指を離すと録音停止
- [ ] `onTouchCancel`: 録音中に指をスライドしてボタンの外に → 録音停止

### 2.3 コンテキストメニュー防止
- [ ] ボタンを長押ししてもコンテキストメニューが表示されない（`onContextMenu` で防止）
- [ ] iOS Safari: 長押しでコンテキストメニューが出ない
- [ ] Android Chrome: 長押しでコンテキストメニューが出ない

---

## 3. エッジケーステスト

### 3.1 二重押下
- [ ] 録音中に再度ボタンを押す
- [ ] 何も起こらない（ガードクローズで保護）
- [ ] エラーが発生しない

### 3.2 処理中の操作
- [ ] 音声処理中（スピナー表示中）にボタンを押す
- [ ] ボタンが無効化されている（`disabled={disabled || isProcessing}`）
- [ ] クリックしても何も起こらない

### 3.3 権限エラー
- [ ] マイク権限を拒否した状態でボタンを押す
- [ ] 適切なエラーメッセージが表示される
- [ ] アプリがクラッシュしない

### 3.4 ネットワークエラー
- [ ] ネットワークを切断して録音 → 停止
- [ ] 適切なエラーメッセージが表示される
- [ ] 再度ネットワーク接続後に正常動作する

---

## 4. デバイス別テスト

### 4.1 スマートフォン（iOS）
#### デバイス: ___________（例: iPhone 14, iOS 17.2）
#### ブラウザ: Safari

- [ ] Push-to-Talk が正常動作
- [ ] 素早い操作でも録音が停止する
- [ ] タッチイベントが正しく発火する
- [ ] コンテキストメニューが表示されない
- [ ] バックグラウンドに移行 → 録音が停止する

### 4.2 スマートフォン（Android）
#### デバイス: ___________（例: Pixel 7, Android 14）
#### ブラウザ: Chrome

- [ ] Push-to-Talk が正常動作
- [ ] 素早い操作でも録音が停止する
- [ ] タッチイベントが正しく発火する
- [ ] コンテキストメニューが表示されない
- [ ] バックグラウンドに移行 → 録音が停止する

### 4.3 タブレット
#### デバイス: ___________（例: iPad Pro）

- [ ] Push-to-Talk が正常動作
- [ ] タッチ操作が正確に認識される
- [ ] 大きい画面でもボタンが押しやすい

### 4.4 PC（デスクトップ/ノートPC）
#### OS: ___________ / ブラウザ: ___________

- [ ] マウス操作で正常動作
- [ ] トラックパッド操作で正常動作
- [ ] `onMouseLeave` が正しく動作する

---

## 5. パフォーマンステスト

### 5.1 連続操作
- [ ] 10回連続で押す → 離す を繰り返す
- [ ] メモリリークが発生しない
- [ ] パフォーマンスが低下しない
- [ ] エラーが蓄積しない

### 5.2 レスポンス時間
- [ ] ボタンを押してから録音開始まで: ________秒
- [ ] ボタンを離してから録音停止まで: ________秒
- [ ] 音声処理完了まで: ________秒

**期待値**:
- 録音開始: < 0.5秒
- 録音停止: 即座（< 0.1秒）← **この修正で改善**
- 音声処理: 1-3秒（ネットワークに依存）

---

## 6. ブラウザコンソールチェック

### 6.1 コンソールエラー
- [ ] 録音開始時にエラーなし
- [ ] 録音停止時にエラーなし
- [ ] 音声処理時にエラーなし

### 6.2 警告メッセージ
- [ ] React warnings なし
- [ ] MediaRecorder warnings なし
- [ ] Deprecation warnings なし

### 6.3 ログ確認（開発環境のみ）
- [ ] `isRecording` の状態遷移が正しい
- [ ] `mediaRecorder.state` の状態遷移が正しい
- [ ] イベントハンドラの実行順序が正しい

---

## 7. 回帰テスト（既存機能が壊れていないか）

### 7.1 既存のガードクローズ
- [ ] `disabled` が `true` の時、ボタンが無効化される
- [ ] `isProcessing` が `true` の時、ボタンが無効化される
- [ ] 無効化中にクリックしても何も起こらない

### 7.2 UI表示
- [ ] 録音中: 赤いボタン + パルスアニメーション
- [ ] 処理中: スピナー表示
- [ ] アイドル: オレンジのマイクアイコン
- [ ] ステータステキストが正しく表示される

### 7.3 音声認識
- [ ] 日本語の音声認識が正常動作
- [ ] 英語の音声認識が正常動作
- [ ] 雑音が多い環境でのエラーハンドリング

---

## 8. 修正の検証（最重要）

### 8.1 修正前の問題が解決しているか
- [ ] **問題1**: ボタンを離しても録音が止まらない → **解決済み**
- [ ] **問題2**: もう一度タップしないと送信されない → **解決済み**
- [ ] **問題3**: 素早い操作で録音が継続する → **解決済み**

### 8.2 Race Condition の解消
- [ ] `handleStopRecording` のガードクローズが `if (disabled)` のみになっている
- [ ] `useVoiceRecorder` の `stopRecording` 内で状態チェックが実施されている
- [ ] 非同期処理のタイミングに関わらず、録音が確実に停止する

---

## 9. テスト結果まとめ

### 成功基準
- [ ] すべての基本機能テストがパス
- [ ] 少なくとも2種類以上のデバイスでテスト成功
- [ ] コンソールエラーが発生しない
- [ ] 修正前の問題が完全に解決している

### 発見された問題
1. ___________________________________________
2. ___________________________________________
3. ___________________________________________

### 総合評価
- [ ] **合格** - 本番環境にデプロイ可能
- [ ] **条件付き合格** - 軽微な問題あり（詳細: ___________）
- [ ] **不合格** - 重大な問題あり（詳細: ___________）

---

## 10. 承認

### テスト実施者
署名: ___________  日付: ___________

### レビュワー
署名: ___________  日付: ___________

### プロジェクトマネージャー
署名: ___________  日付: ___________

---

## 備考・メモ

___________________________________________
___________________________________________
___________________________________________
___________________________________________
